###########################################################################
######### Makefile for lmsuite (LATTE, MUSE Suite) on linux/unix ##########
###########################################################################

# define objects
OBJS = main.o process_inputs.o initialize.o precision95.o \
	working_variables.o parameters.o \
	scan_data_class.o solveTWT.o TWTmodules.o ode_functions.o \
	latte_dc_constant.o movie_data_class.o make_frames.o \
	clean_ops_nix_$(F90).o

# define libraries
LIBDIR = -L./mini_slatec/ -L./mini_lapack/complex16 -L./mini_lapack/util \
	-L./mini_blas 
LIBS = $(LIBDIR) -lmini_slatec_s -lmini_lapack_Z_s -lmini_lapack_util_s \
	-lmini_blas_s
###########################################################################
# Goal target is lmsuite, all object files are prerequisites
lmsuite : $(OBJS) mini_slatec_lib mini_lapack_lib mini_blas_lib
	$(F90) -o lmsuite $(FFLAGS_LINK) $(OBJS) $(LIBS);

# local library of small subset of SLATEC routines
mini_slatec_lib :
	cd mini_slatec; make -f makefile_linux

mini_blas_lib :
	cd mini_blas; make -f makefile_linux

mini_lapack_lib :
	cd mini_lapack/util/; make -f makefile_linux;
	cd mini_lapack/complex16; make -f makefile_linux

###########################################################################
#implicit rule to tell how to make object files from *.f90 files
%.o : %.f90
	$(F90) -c $(FFLAGS_LMSUITE) $*.f90

###########################################################################
#prerequisites for the object files, made using implicit rule as defined above.
main.o : process_inputs.o solveTWT.o
process_inputs.o : parameters.o
working_variables.o : parameters.o
initialize.o : working_variables.o clean_ops_nix_$(F90).o
parameters.o : scan_data_class.o movie_data_class.o
scan_data_class.o : precision95.o
movie_data_class.o : precision95.o
solveTWT.o : parameters.o TWTmodules.o
TWTmodules.o : precision95.o parameters.o ode_functions.o commonTWT.i90
ode_functions.o : precision95.o parameters.o working_variables.o #TWTmodules.o
commonTWT.i90 : ode_functions.o latte_dc_constant.o make_frames.o
precision95.o :
latte_dc_constant.o :
make_frames.o :
clean_ops_nix_$(F90).o :

###########################################################################
#make clean to delete everything and start over.
#.PHONY tells make that clean is not a file target and assumes prerequisites
#are satisfied. This feature is not present in all make utilities, so if
#use something other than Gnu Make, may need to use "FORCE" empty target,
#see make info.
#the - in front of rm tells make to continue even if rm reports errors.
.PHONY : clean cleansrc cleanlib
clean : cleansrc cleanlib
cleansrc:
	-rm $(OBJS) $(CLEANUP)
cleanlib:
	-cd mini_slatec; make -f makefile_linux realclean;
	-cd mini_blas; make -f makefile_linux realclean;
	-cd mini_lapack/util; make -f makefile_linux realclean;
	-cd mini_lapack/complex; make -f makefile_linux realclean;
	-cd mini_lapack/complex16; make -f makefile_linux realclean;
